$(document).ready(function(){$(".loading-spinner").hide(),$(".spinner").hide(),$("#search").prop("disabled",!0),$("#myTable").DataTable({searching:!1,paging:!1,info:!1,sorting:!1}),$("#customerTable").DataTable({searching:!0,paging:!0,info:!1,sorting:!1,pageLength:5}),$("#salesTable").DataTable({responsive:!0,order:[[0,"desc"]],dom:"Bfrtip",buttons:["copy","csv","excel","pdf","print"]});const t=Swal.mixin({showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, proceed!",showCloseButton:!0}),a=Swal.mixin({showCancelButton:!0,confirmButtonColor:"#00a65a",cancelButtonColor:"#d33",confirmButtonText:"Yes, print reciept!",cancelButtonText:"No.",showCloseButton:!0}),o=Swal.mixin({showCancelButton:!0,confirmButtonColor:"#00a65a",cancelButtonColor:"#d33",confirmButtonText:"Return on stock.",cancelButtonText:"Reject item.",showCloseButton:!0});function i(t){return-1==t.indexOf(".")?t+".00":t}function s(t){return t.toLocaleString()}function c(){document.getElementById("audio").play()}$("#payment").attr("disabled",!0),$("#proceed").attr("disabled",!0),$("#new_item").on("hide.bs.modal",function(t){$("#barcode").focus()}),$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}),$(".modal").on("shown.bs.modal",function(){$(this).find("[autofocus]").focus()}),$(".modal").on("hidden.bs.modal",function(){$("#barcode").focus()}),$("#btnSetting").click(function(){$("#printer").modal("show")}),$("#print_receipt").click(function(){$("#receipt").modal("show")}),$("#printBtn").click(function(t){""!==$("#invoice").val()?window.location="/index.php/index.php/cashier/"+$("#invoice").val():t.preventDefault()}),async function(){const o=await fetch("/index.php/index.php/getProducts").then(t=>t.json()).catch(t=>location.reload());let n=[],r=[],l=0;const u=[],d=[];let p=0,h="",f="",m="";for(let t=0;t<o.length;t++){const e=o[t].id,a=o[t].name,i=o[t].barcode,s=o[t].brand,c=o[t].price,l=o[t].stocks.quantity,u=o[t].image,d=o[t].unit,p=o[t].status,$=o[t].net_wt,h=o[t].profit,f=Object.assign({id:e,barcode:i,name:a,price:c,profit:h,stock:l,image:u,unit:d,status:p,net_wt:$,brand:s});n.push(f),r.push(a+" "+$+" "+s)}function v(t){return+(Math.round(t+"e+2")+"e-2")}pay_proceed=(()=>{parseFloat($("#cash").val())>=l?$.ajax({url:"/index.php/index.php/cashier",method:"POST",data:{_token:token,cart:u,cash:parseFloat($("#cash").val()),discount:p,total:l,customer:h,business_style:f,customer_address:m},dataType:"json",success:function(t){a.fire({type:"warning",title:"Print Reciept?"}).then(e=>{e.value?window.location="/index.php/index.php/cashier/"+t:window.location="/index.php/index.php/cashier/noreciept"})}}):$(".errorcash").html("Insufficient Cash!")}),$("#proceed").on("click",function(){t.fire({type:"warning",title:"Transaction Proceed?"}).then(t=>{if(!t.value)return e.preventDefault(),!1;pay_proceed()})}),$("#removedisc").on("click",function(){$(".customercart").html(""),$(".customerdiscount").html("0"),$("#less").val(""),p=0,h="",f="",m=""}),$("#less").on("keyup",function(){const t=$("#price").val();$(this).val()>parseInt(t)&&$(this).val("")}),applyDiscount=(t=>{if(h&&""!==h){const e=t,a=v(100-parseInt(p));return v(a*parseFloat(e.replace(/,/g,""))/100)}{const e=t,a=$("#less").val();return p=v(a/e*100),$(".customerdiscount").html(p),v((100-p)*parseFloat(e.replace(/,/g,""))/100)}}),dataoutput=(()=>{let e=0;$("#dataTable").html(u.map((t,e)=>'<tr><td class="text-truncate" style="max-width:100px; vertical-align: middle;">'+t.name+"</td><td>"+t.net_wt+"</td><td>"+t.unit+"</td><td>₱ "+t.price+"</td><td>"+t.quantity+"</td><td>₱ "+t.subtotal+'</td><td><a href="#" class="text-success" id="plus'+e+'"><i class="fas fa-plus-circle fa-2x"></i></a> <a  href="#" class="text-primary" id="minus'+e+'"><i class="fas fa-minus-circle fa-2x"></i></a> <a  href="#" class="text-danger" id="trash'+e+'"><i class="fas fa-trash-alt fa-2x"></i></a></td></tr>'));for(let t=0;t<u.length;t++)parseFloat(u[t].subtotal.replace(/,/g,"")),e+=parseFloat(u[t].subtotal.replace(/,/g,""));const a=s(e);$("#pname").html("₱ "+i(a)),l=e,$("#cash").on("input",function(t){var a=t.keyCode||t.which,o=parseFloat($(this).val()),i=0;if(i=Number.isInteger(o)?o.toString().length<=3?o.toFixed(2):s(o)+".00":o.toFixed(2),isNaN(o)?$(".cash").html(""):$(".cash").html(i),""==$(this).val()?$("#change").hide():parseFloat($(this).val())>=e?($("#change").show(),total=parseFloat($(this).val())-parseFloat(e),$("#change").text(s(total)),$("#proceed").attr("disabled",!1)):($("#change").hide(),total=parseFloat($(this).val())-parseFloat(e),$("#change").text(s(total)),$("#proceed").attr("disabled",!0)),13==a)return t.preventDefault(),!1}),u.map((e,a)=>{$("#plus"+a).on("click",function(){n.filter((t,a)=>{if(t.barcode==e.barcode)if(t.stock>e.quantity){let a,o,n=1,r=100-parseInt(p);p>0?(a=r*parseFloat(t.price.replace(/,/g,""))/100,o=n*a):(a=parseFloat(t.price.replace(/,/g,"")),o=n*a);const l=s(o);$("#payment").attr("disabled",!1),inserProduct=(()=>{const e=Object.assign({id:t.id,barcode:t.barcode,name:t.name,unit:t.unit,price:t.price,profit:t.profit,status:t.status,quantity:n,subtotal:i(l),net_wt:t.net_wt});u.push(e),d.push(t.barcode)}),u.length>0&&d.find(t=>t==e.barcode)?u.filter((t,o)=>{if(t.barcode===e.barcode){const e=t.quantity+1,o=s(a+parseFloat(t.subtotal.replace(/,/g,"")));t.subtotal=i(o),t.quantity=e}}):inserProduct(),$(this).val(""),dataoutput(),c()}else Swal.fire("Out of Stock!","This item is out of stock!","error")})}),$("#minus"+a).on("click",function(o){n.filter((n,r)=>{if(n.barcode==e.barcode&&n.stock>e.quantity)if(e.quantity>1){let t,a,o=1,r=100-parseInt(p);p>0?(t=r*parseFloat(n.price.replace(/,/g,""))/100,a=o*t):(t=parseFloat(n.price.replace(/,/g,"")),a=o*t);const l=s(a);$("#payment").attr("disabled",!1),inserProduct=(()=>{const t=Object.assign({id:n.id,barcode:n.barcode,name:n.name,unit:n.unit,price:n.price,profit:n.profit,status:n.status,quantity:o,subtotal:i(l),net_wt:n.net_wt});u.push(t),d.push(n.barcode)}),u.length>0&&d.find(t=>t==e.barcode)?u.filter((a,o)=>{if(a.barcode===e.barcode){const e=a.quantity-1,o=s(parseFloat(a.subtotal.replace(/,/g,""))-t);a.subtotal=i(o),a.quantity=e}}):inserProduct(),$(this).val(""),dataoutput(),c()}else t.fire({type:"warning",title:"This item will be remove in cart!"}).then(t=>{t.value?u.filter((t,e)=>{if(e==a&&e>-1){u.splice(e,1),c();const a=d.indexOf(t.barcode);d.splice(a,1),dataoutput()}}):o.preventDefault()})})}),$("#trash"+a).on("click",function(e){t.fire({type:"warning",title:"This item will be remove in cart!"}).then(t=>{t.value?u.filter((t,e)=>{if(e==a&&e>-1){u.splice(e,1),c();const a=d.indexOf(t.barcode);d.splice(a,1),dataoutput()}}):e.preventDefault()})})})}),$("#barcode").on("input",function(t){setTimeout(()=>{n.filter((t,e)=>{const a=$(this).val();if(t.barcode===a)if(t.stock>0){let e,o,n=1,r=100-parseInt(p);p>0?(e=r*parseFloat(t.price.replace(/,/g,""))/100,o=n*e):(e=parseFloat(t.price.replace(/,/g,"")),o=n*e);const l=s(o);$("#payment").attr("disabled",!1),inserProduct=(()=>{const e=Object.assign({id:t.id,barcode:t.barcode,name:t.name,unit:t.unit,price:t.price,profit:t.profit,status:t.status,quantity:n,subtotal:i(l),net_wt:t.net_wt});u.push(e),d.push(t.barcode)}),u.length>0&&d.find(t=>t==a)?u.filter((t,o)=>{if(t.barcode===a){const a=t.quantity+1,o=s(e+parseFloat(t.subtotal.replace(/,/g,"")));t.subtotal=i(o),t.quantity=a}}):inserProduct(),$(this).val(""),dataoutput(),c()}else Swal.fire("Out of Stock!","This item is out of stock!","error")})},250)}),addItems=(()=>{$("#search").autocomplete({source:r,select:function(){setTimeout(()=>{n.filter((t,e)=>{t.name+" "+t.net_wt+" "+t.brand===$(this).val()&&($("#id").val(t.id),$("#codebar").val(t.barcode),$("#unit").val(t.unit),$("#name").val(t.name),$("#price").val(t.price),$("#net_wt").val(t.net_wt),$("#quantity").attr("max",t.stock),$("#stocks").val(t.stock),$("#less").focus(),$("#status").val(t.status),$("#profit").val(t.profit))})},100)}}),cart_add=(()=>{let t=parseInt($("#quantity").val());if(t&&t>0)if(t<=parseInt($("#stocks").val())){$("#payment").attr("disabled",!1);const e=$("#price").val();applyDiscount(e);const a=applyDiscount(e);let o,n;p>0?n=t*(o=a):(o=parseFloat(e.replace(/,/g,"")),n=t*o);const r=s(n);if(d.find(t=>t==$("#codebar").val()))u.filter((e,a)=>{if(e.barcode==$("#codebar").val()){const a=e.quantity+t,n=s(o+parseFloat(e.subtotal.replace(/,/g,"")));a<=parseInt($("#stocks").val())?(e.subtotal=i(n),e.quantity=a,e.discount=p,c(),dataoutput(),$("#search").val(""),$("#codebar").val(""),$("#id").val(""),$("#unit").val(""),$("#name").val(""),$("#price").val(""),$("#quantity").val(""),$("#search").focus(),$("#stocks").val(""),$("#profit").val(""),$("#status").val(""),$("#net_wt").val(""),$(".errorstock").html("")):$(".errorstock").html("Out of Stock!, Please check your cart and stock!")}});else{const e=Object.assign({id:$("#id").val(),barcode:$("#codebar").val(),name:$("#name").val(),unit:$("#unit").val(),price:$("#price").val(),profit:$("#profit").val(),status:$("#status").val(),net_wt:$("#net_wt").val(),quantity:t,subtotal:i(r),discount:p});u.push(e),d.push($("#codebar").val()),c(),dataoutput(),$("#search").val(""),$("#codebar").val(""),$("#id").val(""),$("#unit").val(""),$("#name").val(""),$("#price").val(""),$("#profit").val(""),$("#quantity").val(""),$("#search").focus(),$("#stocks").val(""),$("#status").val(""),$("#net_wt").val(""),$("#less").val(""),$(".errorstock").html("")}console.log(u)}else $(".errorstock").html("Out of Stock!, Please check your cart and stock!")}),$("#add_cart").click(function(){cart_add()}),$("input[name=quantity]").on("keydown",function(t){var e=t.keyCode||t.which;return 13==e?(cart_add(),t.preventDefault(),!1):36==e?(t.preventDefault(),$("#search").val(""),$("#codebar").val(""),$("#id").val(""),$("#unit").val(""),$("#name").val(""),$("#price").val(""),$("#profit").val(""),$("#quantity").val(""),$("#search").focus(),$("#stocks").val(""),$("#status").val(""),$("#net_wt").val(""),$("#search").focus(),!1):void 0}),$("#clearing").click(function(){$("#search").val(""),$("#codebar").val(""),$("#id").val(""),$("#unit").val(""),$("#name").val(""),$("#price").val(""),$("#quantity").val(""),$("#profit").val(""),$("#search").focus(),$("#stocks").val(""),$("#status").val(""),$("#net_wt").val(""),$("#search").focus()}),$("#search").on("keydown",function(t){if(37==(t.keyCode||t.which))return t.preventDefault(),!1})}),$("#add_item").click(function(){$("#new_item").modal("show"),setTimeout(()=>{$("#search").prop("disabled",!1),$("#search").focus(),addItems()},1e3),h&&""!==h?$("#less").prop("disabled",!0):$("#less").prop("disabled",!1)}),$("#customers").click(function(){$("#searchcustomer").modal("show"),$(".selectbuy").on("click",function(){var t=$(this).data("stuff");$(".customercart").html("["+t[0]+"]"),$(".customerdiscount").html(t[1]),p=t[1],h=t[0],f=t[2],m=t[3],$("#searchcustomer").modal("hide")})}),$("#cancel_transac").click(function(){u.splice(0,u.length),d.splice(0,d.length),c(),dataoutput(),$("#cash").val(""),$(".errorcash").html(""),$("#barcode").focus(),$(".cash").html(""),$("#change").html(""),p=0,$(".customerdiscount").html("0")}),$("input[name=barcode]").on("keydown",function(t){var e=t.keyCode||t.which;if(119==e)return $("#new_item").modal("show"),t.preventDefault(),setTimeout(()=>{$("#search").prop("disabled",!1),$("#search").focus(),addItems()},1e3),!1;192==e&&($("#searchcustomer").modal("show"),$(".selectbuy").on("click",function(){var t=$(this).data("stuff");$(".customercart").html("["+t[0]+"]"),$(".customerdiscount").html(t[1]),p=t[1],h=t[0],f=t[2],m=t[3],$("#searchcustomer").modal("hide")}))}),$("#cash").on("keyup",function(e){13==(e.keyCode||e.which)&&t.fire({type:"warning",title:"Transaction Proceed?"}).then(t=>{t.value?pay_proceed():e.preventDefault()})}),$(document).keyup(function(t){var e=t.keyCode||t.which;if(119==e)return $("#new_item").modal("show"),h&&""!==h?$("#less").prop("disabled",!0):$("#less").prop("disabled",!1),t.preventDefault(),setTimeout(()=>{$("#search").prop("disabled",!1),$("#search").focus(),addItems()},1e3),!1;192==e&&($("#searchcustomer").modal("show"),$(".selectbuy").on("click",function(){var t=$(this).data("stuff");$(".customercart").html("["+t[0]+"]"),$(".customerdiscount").html(t[1]),p=t[1],h=t[0],f=t[2],m=t[3],$("#searchcustomer").modal("hide")})),33==e&&$("#barcode").focus(),36==e&&$("#cash").focus(),46==e&&(u.splice(0,u.length),d.splice(0,d.length),c(),dataoutput(),$("#cash").val(""),$(".errorcash").html(""),$("#barcode").focus(),$(".cash").html(""),$("#change").html(""),$(".customerdiscount").html("0"),$(".customercart").html(""),p=0,h="",f="",m="")})}(),$("#salesTable").on("click",".void",function(){var t=$(this).data("stuff");$("#void").modal("show"),""!==$(".reason").val()?$(".item_void").prop("disabled",!1):$(".item_void").prop("disabled",!0),$("#item_name").val(t[2]),$("#item_quantity").val(t[6]),$("#item_quantity").attr("max",t[6]),$("#item_id").val(t[0]),$("#item_inv").val(t[1]),$("#item_netwt").val(t[3]),$("#item_unit").val(t[4]),$("#item_price").val(t[5]),$("#item_sub").val(t[7]),$("#item_cashier").val(t[8]),$("#item_barcode").val(t[9]),$("#item_profit").val(t[10]),$(".reason").on("keyup",function(){""!==$(this).val()?$(".item_void").prop("disabled",!1):$(".item_void").prop("disabled",!0)}),$(".item_void").on("click",function(t){o.fire({type:"warning",title:"Return On Stock?"}).then(e=>{if(e.value)$("#item_status").val("Return On Stock"),setTimeout(()=>{$("#voidfrm").submit()},500);else{if("cancel"!=e.dismiss)return t.preventDefault(),!1;$("#item_status").val("Rejected"),setTimeout(()=>{$("#voidfrm").submit()},500)}})})})});
